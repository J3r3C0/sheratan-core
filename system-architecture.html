<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheratan Core - System Architecture Diagram</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #38bdf8;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .legend-dot {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .section {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .component {
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .component:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .component.docker {
            border-color: #3b82f6;
        }

        .component.api {
            border-color: #22c55e;
        }

        .component.file {
            border-color: #f59e0b;
        }

        .component.script {
            border-color: #a855f7;
        }

        .component.dashboard {
            border-color: #ec4899;
        }

        .component.deprecated {
            border-color: #ef4444;
            opacity: 0.6;
        }

        .component.active {
            border-color: #38bdf8;
            box-shadow: 0 0 15px rgba(56, 189, 248, 0.3);
        }

        .component-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .component-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 12px;
        }

        .component-name {
            font-weight: 600;
            font-size: 13px;
        }

        .component-type {
            font-size: 10px;
            color: #64748b;
            margin-left: auto;
        }

        .component-desc {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 6px;
        }

        .component-files {
            font-size: 10px;
            color: #64748b;
            margin-top: 8px;
            font-family: monospace;
        }

        .status-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #0f172a;
        }

        .status-ok {
            background: #22c55e;
        }

        .status-warn {
            background: #f59e0b;
        }

        .status-error {
            background: #ef4444;
        }

        .status-unknown {
            background: #64748b;
        }

        /* Tooltip */
        .tooltip {
            display: none;
            position: fixed;
            background: #0f172a;
            border: 1px solid #38bdf8;
            border-radius: 8px;
            padding: 12px;
            max-width: 350px;
            z-index: 1000;
            font-size: 11px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .tooltip.visible {
            display: block;
        }

        .tooltip h4 {
            color: #38bdf8;
            margin-bottom: 8px;
        }

        .tooltip-section {
            margin-top: 8px;
        }

        .tooltip-section-title {
            color: #94a3b8;
            font-size: 10px;
            margin-bottom: 4px;
        }

        .tooltip-code {
            background: #1e293b;
            padding: 6px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 10px;
            overflow-x: auto;
        }

        .tooltip-flow {
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .tooltip-flow-item {
            background: #334155;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }

        .tooltip-flow-arrow {
            color: #38bdf8;
        }

        /* Connections overlay */
        .connections-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px;
            background: rgba(56, 189, 248, 0.05);
            border-radius: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .flow-box {
            background: #1e293b;
            border: 1px solid #334155;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 11px;
            text-align: center;
        }

        .flow-arrow {
            color: #38bdf8;
            font-size: 18px;
        }

        .flow-label {
            font-size: 9px;
            color: #64748b;
            text-align: center;
            margin-top: 4px;
        }

        /* Issues section */
        .issues {
            grid-column: 1 / -1;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .issue-item {
            display: flex;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid rgba(239, 68, 68, 0.2);
        }

        .issue-item:last-child {
            border-bottom: none;
        }

        .issue-icon {
            color: #ef4444;
        }

        .issue-text {
            font-size: 12px;
        }

        .issue-fix {
            color: #22c55e;
            font-size: 11px;
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <h1>üåü Sheratan Core - System Architecture</h1>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot" style="background:#3b82f6"></div> Docker Service
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background:#22c55e"></div> API Endpoint
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background:#f59e0b"></div> File/Volume
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background:#a855f7"></div> Script
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background:#ec4899"></div> Dashboard
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background:#ef4444"></div> ‚ö†Ô∏è Issue/Deprecated
        </div>
    </div>

    <div class="container">
        <!-- DOCKER SERVICES -->
        <div class="section">
            <div class="section-title">üê≥ Docker Services</div>

            <div class="component docker active" data-info="backend">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#3b82f6">üîß</div>
                    <span class="component-name">sheratan_backend</span>
                    <span class="component-type">Port 8000</span>
                </div>
                <div class="component-desc">Backend PoC - Quick Start, Metrics</div>
                <div class="component-files">backend/main.py</div>
            </div>

            <div class="component docker active" data-info="core">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#3b82f6">‚öôÔ∏è</div>
                    <span class="component-name">sheratan_core</span>
                    <span class="component-type">Port 8001</span>
                </div>
                <div class="component-desc">Core API - Missions, Tasks, Jobs CRUD</div>
                <div class="component-files">core/ (gitignored)</div>
            </div>

            <div class="component docker active" data-info="worker">
                <div class="status-badge status-warn"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#3b82f6">üë∑</div>
                    <span class="component-name">sheratan_worker</span>
                    <span class="component-type">No Port</span>
                </div>
                <div class="component-desc">Job Processor - Direct LLM Calls</div>
                <div class="component-files">worker/worker_loop.py</div>
            </div>

            <div class="component docker deprecated" data-info="webrelay-docker">
                <div class="status-badge status-error"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#ef4444">üîå</div>
                    <span class="component-name">sheratan_webrelay (Docker)</span>
                    <span class="component-type">Port 3000</span>
                </div>
                <div class="component-desc">‚ö†Ô∏è NICHT VERWENDET - Lokal statt Docker!</div>
                <div class="component-files">webrelay/Dockerfile</div>
            </div>
        </div>

        <!-- LOCAL SERVICES -->
        <div class="section">
            <div class="section-title">üíª Local Services</div>

            <div class="component api active" data-info="webrelay-local">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#22c55e">üåê</div>
                    <span class="component-name">WebRelay (Lokal)</span>
                    <span class="component-type">Port 3000</span>
                </div>
                <div class="component-desc">ChatGPT Puppeteer Bridge - Self-Loop/LCP</div>
                <div class="component-files">webrelay/src/index.ts</div>
            </div>

            <div class="component dashboard active" data-info="react-dashboard">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#ec4899">üìä</div>
                    <span class="component-name">React Dashboard</span>
                    <span class="component-type">Port 3001</span>
                </div>
                <div class="component-desc">Modernes UI - Missions, Jobs, Self-Loop</div>
                <div class="component-files">1_Sheratan_Dev_Dashboard/</div>
            </div>

            <div class="component dashboard" data-info="html-dashboard">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#ec4899">üìÑ</div>
                    <span class="component-name">HTML Dashboard</span>
                    <span class="component-type">Static File</span>
                </div>
                <div class="component-desc">Funktionales Single-File Dashboard</div>
                <div class="component-files">sheratan-dashboard.html</div>
            </div>

            <div class="component api" data-info="chrome">
                <div class="status-badge status-unknown"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#22c55e">üåç</div>
                    <span class="component-name">Chrome Debug</span>
                    <span class="component-type">Port 9222</span>
                </div>
                <div class="component-desc">Remote Debugging f√ºr Puppeteer</div>
                <div class="component-files">start_chrome.bat</div>
            </div>
        </div>

        <!-- FILES & VOLUMES -->
        <div class="section">
            <div class="section-title">üìÅ Files & Volumes</div>

            <div class="component file deprecated" data-info="webrelay-out">
                <div class="status-badge status-error"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#ef4444">üì§</div>
                    <span class="component-name">webrelay_out/</span>
                    <span class="component-type">Host Folder</span>
                </div>
                <div class="component-desc">‚ö†Ô∏è LEER! Docker schreibt in Volume!</div>
                <div class="component-files">Worker ‚Üí Volume, nicht Host</div>
            </div>

            <div class="component file deprecated" data-info="webrelay-in">
                <div class="status-badge status-warn"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#f59e0b">üì•</div>
                    <span class="component-name">webrelay_in/</span>
                    <span class="component-type">Host Folder</span>
                </div>
                <div class="component-desc">WebRelay Results zur√ºck</div>
                <div class="component-files">Gleiche Volume-Problematik</div>
            </div>

            <div class="component file" data-info="docker-volumes">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#f59e0b">üíæ</div>
                    <span class="component-name">Docker Named Volumes</span>
                    <span class="component-type">Internal</span>
                </div>
                <div class="component-desc">relay-out, relay-in, core-data</div>
                <div class="component-files">docker-compose.yml volumes:</div>
            </div>

            <div class="component file" data-info="project">
                <div class="status-badge status-ok"></div>
                <div class="component-header">
                    <div class="component-icon" style="background:#f59e0b">üìÇ</div>
                    <span class="component-name">project/</span>
                    <span class="component-type">Mounted</span>
                </div>
                <div class="component-desc">Workspace f√ºr Code Analysis</div>
                <div class="component-files">./project:/workspace/project</div>
            </div>
        </div>

        <!-- DATA FLOWS -->
        <div class="section connections-section">
            <div class="section-title">üîÑ Loop Formate (Type A & B)</div>

            <!-- Type A: Execution Loop -->
            <div
                style="margin-bottom: 12px; padding: 10px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border-left: 3px solid #22c55e;">
                <div style="font-size: 13px; color: #22c55e; font-weight: 600; margin-bottom: 8px;">
                    üÖ∞Ô∏è Type A: Execution Loop (Test/Demo)
                </div>
                <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">
                    Einzelne Jobs direkt ausf√ºhren: list_files, read_file, write_file<br>
                    <strong>Payload:</strong> <code>payload.task.kind = "list_files" | "read_file" | ...</code>
                </div>
                <div class="flow-diagram" style="margin-bottom: 0;">
                    <div class="flow-box">Add Job Modal<br><small>kind: list_files</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box">Core API<br><small>dispatch</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box">Worker<br><small>Lokale Ausf√ºhrung</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="border-color:#22c55e">Result<br><small>JSON zur√ºck</small></div>
                </div>
            </div>

            <!-- Type B: Mission Loop -->
            <div
                style="margin-bottom: 12px; padding: 10px; background: rgba(56, 189, 248, 0.1); border-radius: 8px; border-left: 3px solid #38bdf8;">
                <div style="font-size: 13px; color: #38bdf8; font-weight: 600; margin-bottom: 8px;">
                    üÖ±Ô∏è Type B: Mission Loop (Autonome Self-Loop)
                </div>
                <div style="font-size: 11px; color: #94a3b8; margin-bottom: 8px;">
                    LLM-gesteuert mit Folgejob-Erstellung (LCP Format)<br>
                    <strong>Payload:</strong> <code>payload.task.kind = "agent_plan"</code> ODER
                    <code>payload.job_type = "sheratan_selfloop"</code>
                </div>
                <div class="flow-diagram" style="margin-bottom: 0;">
                    <div class="flow-box">Quick Start<br><small>kind: agent_plan</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box">Worker<br><small>call_llm_generic()</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box">WebRelay<br><small>:3000/api/relay</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box">ChatGPT<br><small>LCP Response</small></div>
                    <span class="flow-arrow">‚Üí</span>
                    <div class="flow-box" style="border-color:#38bdf8">create_followup_jobs<br><small>‚Üí Neue
                            Jobs</small></div>
                </div>
            </div>

            <!-- ‚ö†Ô∏è Type Erkennung -->
            <div
                style="background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 8px; border-left: 3px solid #f59e0b; font-size: 11px;">
                <strong style="color: #f59e0b;">‚ö†Ô∏è Typ-Erkennung im Worker (worker_loop.py):</strong>
                <ul style="margin: 8px 0 0 20px; color: #94a3b8;">
                    <li><code>payload.task.kind == "list_files|read_file|write_file"</code> ‚Üí Type A</li>
                    <li><code>payload.task.kind == "agent_plan"</code> ‚Üí Type B (LLM Call)</li>
                    <li><code>payload.job_type == "sheratan_selfloop"</code> ‚Üí Type B (Legacy Format)</li>
                </ul>
            </div>
        </div>

        <!-- IDENTIFIED ISSUES -->
        <div class="section issues">
            <div class="section-title">‚ö†Ô∏è Identifizierte Probleme</div>

            <div class="issue-item">
                <div class="issue-icon" style="color:#22c55e">‚úÖ</div>
                <div>
                    <div class="issue-text"><strong>Volume Mismatch:</strong> <s>Docker Worker schreibt in Named
                            Volume</s> ‚Üí GEFIXT!</div>
                    <div class="issue-fix">docker-compose.yml: Host-Mounts ./webrelay_out und ./webrelay_in statt Named
                        Volumes</div>
                </div>
            </div>

            <div class="issue-item">
                <div class="issue-icon">‚ÑπÔ∏è</div>
                <div>
                    <div class="issue-text"><strong>Zwei WebRelay-Versionen:</strong> Docker und Lokal ‚Äì beide
                        funktionieren!</div>
                    <div class="issue-fix">INFO: Entscheidung n√∂tig: Entweder Docker WebRelay ODER Lokales.
                        Siehe WEBRELAY_ANALYSIS.md f√ºr Details.</div>
                </div>
            </div>

            <div class="issue-item">
                <div class="issue-icon" style="color:#22c55e">‚úÖ</div>
                <div>
                    <div class="issue-text"><strong>Job-Typen getrennt:</strong> Self-Loop Jobs (Quick Start) vs Regular
                        Jobs (Add Job Modal)</div>
                    <div class="issue-fix">DESIGN: Gewollt und klar getrennt! Verschiedene Tools f√ºr verschiedene
                        Zwecke.</div>
                </div>
            </div>

            <div class="issue-item">
                <div class="issue-icon">‚ùì</div>
                <div>
                    <div class="issue-text"><strong>LLM Config:</strong> SHERATAN_LLM_BASE_URL nicht gesetzt - Docker
                        Worker wei√ü nicht wohin</div>
                    <div class="issue-fix">FIX: .env mit LLM Endpoint konfigurieren (f√ºr Regular Jobs)</div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div style="grid-column: 1 / -1; text-align: center; padding: 20px; color: #64748b; font-size: 11px;">
            üìÖ Letzte Aktualisierung: <span id="timestamp">2024-12-14 14:50</span> |
            üìÑ <a href="WEBRELAY_ANALYSIS.md" style="color: #38bdf8;">WEBRELAY_ANALYSIS.md</a> |
            üîß Dieses Diagramm: system-architecture.html
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip">
        <h4 id="tooltip-title">Component</h4>
        <div id="tooltip-content"></div>
    </div>

    <script>
        const componentInfo = {
            'backend': {
                title: 'Backend PoC (sheratan_backend)',
                endpoints: ['POST /api/missions/standard-code-analysis', 'GET /api/status', 'POST /metrics/module-calls'],
                flow: ['React Dashboard', 'Backend PoC', 'Core API'],
                note: 'Vereinfachter Einstiegspunkt f√ºr Quick Start. Erstellt komplette Self-Loop Mission.'
            },
            'core': {
                title: 'Core API (sheratan_core)',
                endpoints: ['GET/POST /api/missions', 'POST /api/missions/{id}/tasks', 'POST /api/tasks/{id}/jobs', 'POST /api/jobs/{id}/dispatch', 'POST /api/jobs/{id}/sync'],
                flow: ['Alle Dashboards', 'Core API', 'SQLite DB'],
                note: 'Zentrale Datenhaltung. Alle CRUD Operationen laufen hier.'
            },
            'worker': {
                title: 'Docker Worker (sheratan_worker)',
                endpoints: ['Liest von: /webrelay_out (Volume)', 'Schreibt nach: /webrelay_in (Volume)'],
                flow: ['Core dispatch', 'Worker', 'Named Volume', '(LLM API?)'],
                note: '‚ö†Ô∏è Schreibt in Docker Named Volume, nicht Host-Ordner! LLM Config fehlt vermutlich.'
            },
            'webrelay-docker': {
                title: 'WebRelay Docker (NICHT VERWENDET)',
                endpoints: [],
                flow: [],
                note: '‚ö†Ô∏è Dockerfile existiert, aber Service l√§uft lokal via npm start. Docker-Version nicht gestartet.'
            },
            'webrelay-local': {
                title: 'WebRelay (Lokal)',
                endpoints: ['GET /health', 'POST /api/llm/call', 'POST /api/job/submit', 'File Watcher: C:\\Sheratan\\2_sheratan_core\\webrelay_out'],
                flow: ['Host-Ordner', 'WebRelay', 'Chrome CDP', 'ChatGPT'],
                note: 'Puppeteer-basiert. Schaut auf HOST-Ordner webrelay_out/ der LEER ist weil Docker in Volume schreibt!'
            },
            'webrelay-out': {
                title: 'webrelay_out/ (Host-Ordner)',
                endpoints: [],
                flow: ['Docker Worker', '‚úó Named Volume', '‚úó Host-Ordner', 'WebRelay'],
                note: '‚ö†Ô∏è PROBLEM: WebRelay erwartet Jobs hier, aber Docker Worker schreibt in Named Volume "relay-out" NICHT in diesen Host-Ordner!'
            },
            'react-dashboard': {
                title: 'React Dashboard (1_Sheratan_Dev_Dashboard)',
                endpoints: ['http://localhost:3001', 'Vite Dev Server'],
                flow: ['Browser', 'React App', 'axios ‚Üí Core API :8001', 'axios ‚Üí Backend PoC :8000'],
                note: 'Modernes React/TypeScript Dashboard. Features: Mission List, Job Table, Quick Start Button, Action Log, Add Job Modal.'
            },
            'html-dashboard': {
                title: 'HTML Dashboard (Single File)',
                endpoints: ['√ñffne direkt im Browser', 'CORE_BASE_URL = localhost:8001', 'WEBRELAY_BASE_URL = localhost:3000'],
                flow: ['Browser', 'fetch() API', 'Core API'],
                note: 'Standalone HTML Dashboard ohne Build-Prozess. Gute Referenz f√ºr korrektes API-Verhalten. Funktioniert zuverl√§ssig.'
            },
            'chrome': {
                title: 'Chrome Debug Mode',
                endpoints: ['ws://localhost:9222', 'Remote Debugging Protocol'],
                flow: ['WebRelay Puppeteer', 'Chrome CDP', 'ChatGPT Tab'],
                note: 'Chrome muss mit --remote-debugging-port=9222 gestartet werden. WebRelay connected via Puppeteer zu diesem Port.'
            },
            'webrelay-in': {
                title: 'webrelay_in/ (Host-Ordner)',
                endpoints: [],
                flow: ['WebRelay', 'Schreibt Result', 'webrelay_in/', 'Worker liest'],
                note: '‚ö†Ô∏è Gleiche Problematik wie webrelay_out: WebRelay schreibt in Host-Ordner, aber Docker Worker liest von Named Volume.'
            },
            'docker-volumes': {
                title: 'Docker Named Volumes',
                endpoints: ['relay-out (f√ºr Jobs)', 'relay-in (f√ºr Results)', 'core-data (SQLite DB)'],
                flow: ['Docker Volume', '‚Üî Container', 'Nicht Host-sichtbar'],
                note: 'Named Volumes sind intern im Docker. Lokale Ordner webrelay_out/ und webrelay_in/ sind NICHT die gleichen Ordner!'
            },
            'project': {
                title: 'project/ (Mounted Volume)',
                endpoints: ['./project:/workspace/project'],
                flow: ['Host project/', '‚Üí Docker /workspace/project', '‚Üí Worker f√ºr Code Analysis'],
                note: '‚úÖ Korrekt gemounted! Hier liegt der zu analysierende Code. Worker kann darauf zugreifen.'
            }
        };

        const tooltip = document.getElementById('tooltip');
        const tooltipTitle = document.getElementById('tooltip-title');
        const tooltipContent = document.getElementById('tooltip-content');

        document.querySelectorAll('.component').forEach(el => {
            el.addEventListener('mouseenter', (e) => {
                const info = componentInfo[el.dataset.info];
                if (!info) return;

                tooltipTitle.textContent = info.title;
                let html = '';

                if (info.endpoints.length) {
                    html += `<div class="tooltip-section">
                        <div class="tooltip-section-title">üì° Endpoints / Paths</div>
                        <div class="tooltip-code">${info.endpoints.join('<br>')}</div>
                    </div>`;
                }

                if (info.flow.length) {
                    html += `<div class="tooltip-section">
                        <div class="tooltip-section-title">üîÑ Data Flow</div>
                        <div class="tooltip-flow">
                            ${info.flow.map((f, i) =>
                        `<span class="tooltip-flow-item">${f}</span>${i < info.flow.length - 1 ? '<span class="tooltip-flow-arrow">‚Üí</span>' : ''}`
                    ).join('')}
                        </div>
                    </div>`;
                }

                if (info.note) {
                    html += `<div class="tooltip-section">
                        <div class="tooltip-section-title">üìù Note</div>
                        <div>${info.note}</div>
                    </div>`;
                }

                tooltipContent.innerHTML = html;
                tooltip.classList.add('visible');
            });

            el.addEventListener('mousemove', (e) => {
                tooltip.style.left = (e.pageX + 15) + 'px';
                tooltip.style.top = (e.pageY + 15) + 'px';
            });

            el.addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });
        });
    </script>
</body>

</html>