name: pages
on: { push: { branches: [ "main" ] }, workflow_dispatch: {} }
permissions: { contents: read, pages: write, id-token: write }
concurrency: { group: pages, cancel-in-progress: true }
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Prepare site
        run: |
          mkdir -p site
          # $ref schnellfix (idempotent)
          sed -E -i "s#\\$ref: '/components/#\\$ref: '#/components/#g" openapi.yaml || true
          cp openapi.yaml site/openapi.yaml
          cat > site/index.html <<'HTML'
<!DOCTYPE html><html><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sheratan Core API</title>
<script src="https://cdn.jsdelivr.net/npm/redoc@next/bundles/redoc.standalone.js"></script>
<style>html,body,#redoc{height:100%;margin:0}</style>
</head><body><div id="redoc"></div>
<script>
  const u = "openapi.yaml?v="+Date.now();
  Redoc.init(u, {}, document.getElementById("redoc"));
</script></body></html>
HTML
          touch site/.nojekyll
      - uses: actions/configure-pages@v5
      - uses: actions/upload-pages-artifact@v3
        with: { path: site }
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment: { name: github-pages, url: ${{ steps.deployment.outputs.page_url }} }
    steps:
      - id: deployment
        uses: actions/deploy-pages@v4
