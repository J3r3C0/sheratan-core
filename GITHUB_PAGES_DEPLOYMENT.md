# GitHub Pages Deployment Guide

This guide explains how to deploy the API documentation to GitHub Pages.

## Overview

The repository is configured to automatically build and deploy the OpenAPI documentation to GitHub Pages using the workflow at `.github/workflows/openapi-docs.yml`.

## Prerequisites

Before the workflow can deploy to GitHub Pages, you need to:

1. **Enable GitHub Pages in the repository settings**:
   - Go to your repository on GitHub
   - Click on **Settings** â†’ **Pages**
   - Under **Source**, select **GitHub Actions**
   - Click **Save**

## Triggering the Deployment

There are two ways to trigger the GitHub Pages deployment:

### Method 1: Automatic Trigger (Recommended)

The workflow automatically runs when you push changes to `openapi.yaml` on the `main` branch:

```bash
# Make changes to openapi.yaml
git add openapi.yaml
git commit -m "Update API documentation"
git push origin main
```

### Method 2: Manual Trigger

You can manually trigger the workflow from the GitHub Actions interface:

1. Go to your repository on GitHub
2. Click on the **Actions** tab
3. In the left sidebar, click on **openapi-docs**
4. Click the **Run workflow** dropdown button (on the right side)
5. Select the branch (typically `main`)
6. Click **Run workflow**

The workflow will:
- Check out the code
- Install redoc-cli
- Build the HTML documentation from `openapi.yaml`
- Upload the docs as a GitHub Pages artifact
- Deploy to GitHub Pages

## Viewing the Deployed Documentation

Once the workflow completes successfully, your documentation will be available at:

```
https://j3rec0.github.io/sheratan-core/
```

## Troubleshooting

### Pages not deploying

1. **Check GitHub Pages is enabled**: Ensure GitHub Pages is configured to use "GitHub Actions" as the source
2. **Check workflow permissions**: The workflow needs `pages: write` and `id-token: write` permissions
3. **Review workflow run**: Check the Actions tab for any errors in the workflow execution

### Documentation not updating

1. Make sure you're pushing to the `main` branch
2. Ensure `openapi.yaml` was modified in your commit
3. Check the workflow run completed successfully

### Build fails

1. Verify `openapi.yaml` is valid OpenAPI 3.0 format
2. Check the workflow logs for specific error messages

## Local Testing

You can test the documentation build locally before deploying:

```bash
# Install redoc-cli
npm install -g redoc-cli

# Build the documentation
redoc-cli build openapi.yaml -o docs/index.html

# Open the generated file in your browser
# The file will be at docs/index.html
```

Note: The generated `docs/index.html` is excluded from git via `.gitignore` as it will be generated by CI.

## Workflow Configuration

The workflow is configured with:

- **Trigger**: Push to main (affecting `openapi.yaml`) or manual dispatch
- **Permissions**: 
  - `contents: read` - Read repository contents
  - `pages: write` - Write to GitHub Pages
  - `id-token: write` - Write ID tokens for deployment
- **Concurrency**: Only one deployment at a time, canceling in-progress runs

For more details, see `.github/workflows/openapi-docs.yml`.
