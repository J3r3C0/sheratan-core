openapi: 3.0.3
info:
  title: Sheratan Core
  version: 1.0.0
  description: >
    Core-API für Sheratan: Health/Version/Metrics sowie LLM-Completion
    und Router-Endpunkte für Modellübersichten & Status.

tags:
  - name: system
    description: Systemnahe Endpunkte (Health, Version, Metrics)
  - name: llm
    description: Text-Completion / Modellaufrufe
  - name: router
    description: Modell-Router Status & Modellauflistungen
  - name: relay
    description: Rückkanal-Callbacks (Status/Final) für externe Flows

paths:
  /health:
    get:
      summary: Liveness/Health-Check
      tags:
        - system
      tags: [system]
      responses:
        "200":
          description: ok

  /version:
    get:
      summary: Version & Build-Info
      tags:
        - system
      tags: [system]
      responses:
        "200":
          description: version

  /metrics:
    get:
      summary: Prometheus-Metriken (wenn aktiviert)
      tags:
        - system
      tags: [system]
      responses:
        "200":
          description: metrics snapshot
          content:
            text/plain:
              schema:
                type: string
        "404":
          description: metrics disabled

  /api/v1/llm/complete:
    post:
      summary: LLM Completion anfordern
      tags:
        - llm
      tags: [llm]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CompleteRequest"
            examples:
              minimal:
                value:
                  prompt: "Say Sheratan online!"
              full:
                value:
                  model: "gpt-4o-mini"
                  prompt: "Sheratan online!"
                  max_tokens: 64
      responses:
        "200":
          description: completion
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CompleteResponse"
              examples:
                ok:
                  value:
                    model: "gpt-4o-mini"
                    output: "Sheratan online!"
                    usage: {}

  /api/v1/router/health:
    get:
      summary: Router-Gesundheit/Status
      tags:
        - router
      tags: [router]
      responses:
        "200":
          description: router health
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RouterHealthResponse"

  /api/v1/router/models:
    get:
      summary: Verfügbare Modelle des Routers
      tags:
        - router
      tags: [router]
      responses:
        "200":
          description: router models
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RouterModelsResponse"

  /relay/status:
    post:
      summary: Asynchrones Status-Event (Zwischenstände)
      tags:
        - relay
      tags: [relay]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RelayStatus"
      responses:
        "200":
          description: accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AckResponse"

  /relay/final:
    post:
      summary: Finaler Callback mit Ergebnis/Fehler
      tags:
        - relay
      tags: [relay]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RelayFinal"
      responses:
        "200":
          description: accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AckResponse"

components:
  schemas:
    CompleteRequest:
      type: object
      properties:
        model:
          type: string
          default: gpt-4o-mini
        prompt:
          type: string
          description: Eingabetext/Prompt
        max_tokens:
          type: integer
          minimum: 1
          maximum: 4096
          default: 128
      required:
        - prompt

    CompleteResponse:
      type: object
      properties:
        model:
          type: string
        output:
          type: string
        usage:
          type: object
          additionalProperties: true
      required:
        - model
        - output

    AckResponse:
      type: object
      properties:
        ok:
          type: boolean
          default: true
      required:
        - ok

    RouterHealthResponse:
      type: object
      properties:
        name:
          type: string
        status:
          type: object
          additionalProperties: true
        metadata:
          type: object
          additionalProperties: true
      required:
        - name
        - status

    RouterModelsResponse:
      type: object
      properties:
        name:
          type: string
        models:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true
      required:
        - name
        - models

    RelayStatus:
      type: object
      properties:
        job_id:
          type: string
        trace_id:
          type: string
        phase:
          type: string
        progress:
          type: integer
        message:
          type: string
        ts:
          type: string
          format: date-time
      required:
        - job_id

    RelayFinal:
      type: object
      properties:
        job_id:
          type: string
        trace_id:
          type: string
        status:
          type: string
        output:
          type: object
          additionalProperties: true
        error:
          type: object
          additionalProperties: true
        metrics:
          type: object
          additionalProperties: true
        ts:
          type: string
          format: date-time
      required:
        - job_id
        - status


